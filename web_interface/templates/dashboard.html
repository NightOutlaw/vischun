<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>üì° –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å–∏–≥–Ω–∞–ª—ñ–≤</title>
    <meta http-equiv="refresh" content="1">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <h1>üì° –û–ø–µ—Ä–∞—Ç–æ—Ä—Å—å–∫–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h1>

    <section>
        <h2>üü¢ –°—Ç–∞—Ç—É—Å–∏ –ø–æ—Ç–æ–∫—ñ–≤</h2>
        <table>
            <tr>
                <th>–ü–æ—Ç—ñ–∫</th>
                <th>–ü–∞–∫–µ—Ç—ñ–≤</th>
                <th>–û—Å—Ç–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</th>
            </tr>
            {% for stream_name, stat in status.items() %}
            <tr>
                <td>{{ stream_name }}</td>
                <td>{{ stat.packets }}</td>
                <td>{{ stat.last_seen or '‚Äî' }}</td>
            </tr>
            {% endfor %}
        </table>
    </section>

    <section>
        <h2>üö® –û—Å—Ç–∞–Ω–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏</h2>
        <table>
            <tr>
                <th>–ß–∞—Å</th>
                <th>–ü–æ—Ç—ñ–∫</th>
                <th>–ß–∞—Å—Ç–æ—Ç–∞</th>
                <th>–û—Ü—ñ–Ω–∫–∞</th>
                <th>–ú–æ–¥—É–ª—ñ</th>
                <th>–û—Ü—ñ–Ω–∫–∞</th>
            </tr>
            {% for alert in alerts %}
            <tr>
                <td>{{ alert.time }}</td>
                <td>{{ alert.stream }}</td>
                <td>{{ '%.2f MHz' % (alert.frequency / 1e6) }}</td>
                <td>{{ alert.score }}</td>
                <td>{{ alert.reasons | join(', ') }}</td>
                <td>
                    {% if verdicts.get(alert.id) %}
                        ‚úÖ {{ verdicts[alert.id] }}
                    {% else %}
                        <form method="POST" action="/api/verdict" onsubmit="return sendVerdict(event, {{ alert.id }})">
                            <button type="submit" name="verdict" value="true">üëç</button>
                            <button type="submit" name="verdict" value="false">üëé</button>
                        </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    </section>

<script>
function sendVerdict(event, id) {
    event.preventDefault();
    const verdict = event.submitter.value;
    fetch('/api/verdict', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: id, verdict: verdict })
    }).then(() => location.reload());
    return false;
}
</script>

</body>
</html>